(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[434],{3030:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sketch",function(){return l(6524)}])},6524:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return c}});var a=l(5893),s=l(7294),r=l(5675),n=l.n(r);function i(e){let{onUploaded:t}=e,l=(0,s.useRef)(null),[r,n]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[o,d]=(0,s.useState)(0),[u,h]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!r)return;let e=URL.createObjectURL(r);return c(e),()=>URL.revokeObjectURL(e)},[r]);let m=async()=>i&&o%360!=0?new Promise((e,t)=>{let l=new Image;l.onload=()=>{let a=document.createElement("canvas"),s=a.getContext("2d"),n=o*Math.PI/180,i=Math.abs(Math.sin(n)),c=Math.abs(Math.cos(n));a.width=l.width*c+l.height*i,a.height=l.width*i+l.height*c,s.translate(a.width/2,a.height/2),s.rotate(n),s.drawImage(l,-l.width/2,-l.height/2),a.toBlob(l=>{l?e(new File([l],r.name,{type:r.type})):t(Error("Canvas is empty"))},r.type)},l.onerror=t,l.src=i}):r,x=async e=>{e.preventDefault();let a=l.current;if(a&&r){h("Uploading...");try{let e=await m(),l=new FormData(a);l.set("file",e,e.name);let s=await fetch("/api/uploads",{method:"POST",body:l}),r=await s.json();r.ok?(h("✅ Uploaded!"),t(),a.reset(),n(null),c(null)):h("❌ Upload failed: "+(r.error||"Unknown error"))}catch(e){h("❌ Error: "+e.message)}}};return(0,a.jsxs)("form",{ref:l,onSubmit:x,className:"space-y-4 p-4 rounded bg-white shadow sm:max-w-md mx-auto",children:[(0,a.jsx)("h2",{className:"font-semibold text-xl text-center",children:"Upload a Sketch"}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[!i&&(0,a.jsx)("input",{type:"file",name:"file",accept:"image/*",required:!0,onChange:e=>{var t;n((null===(t=e.target.files)||void 0===t?void 0:t[0])||null),d(0),h("")},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),i&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:i,alt:"Preview",className:"max-w-full max-h-64 rounded",style:{transform:"rotate(".concat(o,"deg)")}}),(0,a.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>d(e=>e-90),className:"bg-gray-800 text-white p-2 rounded-full",children:"↺"}),(0,a.jsx)("button",{type:"button",onClick:()=>d(e=>e+90),className:"bg-gray-800 text-white p-2 rounded-full",children:"↻"})]})]})]}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",name:"title",placeholder:"Title",required:!0,className:"block w-full border p-2 rounded"}),(0,a.jsx)("input",{type:"text",name:"style",placeholder:"Style (e.g., ink, watercolor)",className:"block w-full border p-2 rounded"}),(0,a.jsx)("textarea",{name:"notes",placeholder:"Notes",className:"block w-full border p-2 rounded",rows:3}),(0,a.jsx)("input",{type:"text",name:"gallery",placeholder:"Gallery (e.g., default, trees, animals)",required:!0,className:"block w-full border p-2 rounded"}),(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",name:"blackAndWhite",value:"1",className:"rounded"}),(0,a.jsx)("span",{children:"Black & White"})]})]}),(0,a.jsx)("button",{type:"submit",disabled:!r,className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50 transition",children:"Upload"}),u&&(0,a.jsx)("p",{className:"text-center text-gray-600",children:u})]})}function c(){let[e,t]=(0,s.useState)([]),[l,r]=(0,s.useState)(!0);async function c(){r(!0);try{let e=await fetch("/api/sketches"),l=await e.json();l.ok&&t(l.sketches)}catch(e){console.error("Error loading sketches:",e)}finally{r(!1)}}return(0,s.useEffect)(()=>{c()},[]),(0,a.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,a.jsx)(i,{onUploaded:c}),(0,a.jsx)("h2",{className:"text-2xl font-bold mt-8 mb-4",children:"Gallery"}),l?(0,a.jsx)("p",{children:"Loading sketches…"}):0===e.length?(0,a.jsx)("p",{children:"No sketches yet. Upload one!"}):(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:e.map(e=>(0,a.jsxs)("div",{className:"border rounded shadow p-2 bg-white",children:[(0,a.jsx)(n(),{src:e.url,alt:e.title,width:400,height:300,className:"object-cover w-full h-auto rounded"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.style}),1===e.black_and_white&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\uD83D\uDDA4 Black & White"}),e.notes&&(0,a.jsx)("p",{className:"text-xs mt-1",children:e.notes}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.created_at).toLocaleString()})]})]},e.id))})]})}}},function(e){e.O(0,[675,888,774,179],function(){return e(e.s=3030)}),_N_E=e.O()}]);