globalThis.disableIncrementalCache = false;globalThis.disableDynamoDBCache = false;globalThis.isNextAfter15 = false;globalThis.openNextDebug = false;globalThis.openNextVersion = "3.7.0";
var f=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var x=(e,t)=>{for(var a in t)f(e,a,{get:t[a],enumerable:!0})},v=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of b(t))!T.call(e,r)&&r!==a&&f(e,r,{get:()=>t[r],enumerable:!(n=p(t,r))||n.enumerable});return e};var N=e=>v(f({},"__esModule",{value:!0}),e);var R={};x(R,{default:()=>w});module.exports=N(R);function i(...e){globalThis.openNextDebug&&console.log(...e)}function C(e){return typeof e=="string"?e:JSON.stringify({tag:e.tag,path:e.path})}async function l(e){let t=globalThis.__openNextAls.getStore();if(i("Writing tags",e,t),!t||globalThis.openNextConfig.dangerous?.disableTagCache)return;let a=e.filter(n=>{let r=C(n),o=!t.writtenTags.has(r);return o&&t.writtenTags.add(r),o});a.length!==0&&await globalThis.tagCache.writeTags(a)}var d=require("node:stream");function g(e,t){let a=e.getReader(),n=[];return new Promise((r,o)=>{function s(){a.read().then(({done:u,value:h})=>{if(u){r(Buffer.concat(n).toString(t?"base64":"utf8"));return}n.push(h),s()}).catch(o)}s()})}function m(e,t){return d.Readable.toWeb(d.Readable.from(Buffer.from(e,t?"base64":"utf8")))}var c=new Map,w={async get(e){try{if(c.has(e))return c.get(e);let t=await globalThis.incrementalCache.get(e,"composable");if(!t?.value?.value)return;if(i("composable cache result",t),globalThis.tagCache.mode==="nextMode"&&t.value.tags.length>0){if(await globalThis.tagCache.hasBeenRevalidated(t.value.tags,t.lastModified))return}else if((globalThis.tagCache.mode==="original"||globalThis.tagCache.mode===void 0)&&await globalThis.tagCache.getLastModified(e,t.lastModified)===-1)return;return{...t.value,value:m(t.value.value)}}catch{i("Cannot read composable cache entry");return}},async set(e,t){c.set(e,t);let a=await t.finally(()=>{c.delete(e)}),n=await g(a.value);if(await globalThis.incrementalCache.set(e,{...a,value:n},"composable"),globalThis.tagCache.mode==="original"){let r=await globalThis.tagCache.getByPath(e),o=a.tags.filter(s=>!r.includes(s));o.length>0&&await l(o.map(s=>({tag:s,path:e})))}},async refreshTags(){},async getExpiration(...e){return globalThis.tagCache.mode==="nextMode"?globalThis.tagCache.getLastRevalidated(e):0},async expireTags(...e){if(globalThis.tagCache.mode==="nextMode")return l(e);let t=globalThis.tagCache,a=Date.now(),n=await Promise.all(e.map(async o=>(await t.getByTag(o)).map(u=>({path:u,tag:o,revalidatedAt:a})))),r=new Set;for(let o of n.flat())r.add(o);await l(Array.from(r))},async receiveExpiredTags(...e){}};
